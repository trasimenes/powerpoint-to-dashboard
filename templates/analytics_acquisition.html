{% extends 'base.html' %}
{% block title %}Analytics - Acquisition Channel Analysis{% endblock %}

{% block content %}
<!-- Webpixels CSS -->
<link href="https://unpkg.com/@webpixels/css@1.1.5/dist/index.css" rel="stylesheet">

<style>
    .dashboard-main {
        background-color: #f8f9fb;
        min-height: 100vh;
    }
    
    .module-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border: 0;
        margin-bottom: 2rem;
    }
    
    .module-card .card-header {
        background: transparent;
        border-bottom: 1px solid #e5e7eb;
        padding: 1.5rem 1.5rem 1rem;
    }
    
    .module-card .card-body {
        padding: 1.5rem;
    }
    
    .dashboard-header {
        background: white;
        border-bottom: 1px solid #e5e7eb;
        padding: 1.5rem 0;
    }
    
    .channel-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        border: 0;
    }
    
    .channel-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
</style>

<!-- Dashboard -->
<div class="d-flex flex-column flex-lg-row h-lg-full">
    {% include 'partials/navigation.html' %}
    
    <!-- Main content -->
    <div class="h-screen flex-grow-1 overflow-y-lg-auto dashboard-main">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-sm-6 col-12">
                        <h1 class="h2 mb-0 ls-tight">Acquisition Channel Analysis</h1>
                        <p class="text-muted mb-0">Slide 32 - Analyse des canaux d'acquisition</p>
                    </div>
                    <div class="col-sm-6 col-12 text-sm-end">
                        <div class="mx-n1">
                            <div class="d-inline-block">
                                <label for="weekSelector" class="form-label small text-muted mb-1">Semaine :</label>
                                <select id="weekSelector" class="form-select form-select-sm"></select>
                            </div>
                            <span id="dashboard-loading" class="text-primary d-none ms-3"><span class="spinner-border spinner-border-sm"></span> Chargement...</span>
                            <span id="dashboard-error" class="text-danger d-none ms-3"></span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main -->
        <main class="py-6">
            <div class="container-fluid">
                <!-- MODULE SLIDE 32 - Acquisition Channel Analysis -->
                <div class="row mb-5">
                    <div class="col-12">
                        <div class="card module-card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-funnel me-2"></i>Acquisition Channel Analysis
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- Acquisition Channels Overview -->
                                <div class="row g-3 mb-4">
                                    <div class="col-md-3">
                                        <div class="card channel-card" style="border: none;">
                                            <div class="card-header text-center" style="background: linear-gradient(135deg, #fec5bb 0%, #fcd5ce 100%); border: none;">
                                                <i class="bi bi-search fs-1 text-white mb-2"></i>
                                                <h6 class="text-white mb-1">SEA</h6>
                                                <div class="text-white small">Search Engine Advertising</div>
                                            </div>
                                            <div class="card-body text-center" style="background: #f8f9fa;">
                                                <div class="mt-2">
                                                    <div class="text-muted small">Sessions WoW: <span class="fw-bold">-7.0%</span></div>
                                                    <div class="text-muted small">Bookings WoW: <span class="fw-bold">-18.0%</span></div>
                                                    <div class="text-muted small">CVR vs LW: <span class="fw-bold">+11.0%</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card channel-card" style="border: none;">
                                            <div class="card-header text-center" style="background: linear-gradient(135deg, #fae1dd 0%, #f8edeb 100%); border: none;">
                                                <i class="bi bi-globe fs-1 text-white mb-2"></i>
                                                <h6 class="text-white mb-1">SEO</h6>
                                                <div class="text-white small">Search Engine Optimization</div>
                                            </div>
                                            <div class="card-body text-center" style="background: #f8f9fa;">
                                                <div class="mt-2">
                                                    <div class="text-muted small">Sessions WoW: <span class="fw-bold">+123%</span></div>
                                                    <div class="text-muted small">Brand CTR: <span class="fw-bold">+11.0%</span></div>
                                                    <div class="text-muted small">Non-Brand: <span class="fw-bold">+75.0%</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card channel-card" style="border: none;">
                                            <div class="card-header text-center" style="background: linear-gradient(135deg, #e8e8e4 0%, #d8e2dc 100%); border: none;">
                                                <i class="bi bi-bullseye fs-1 text-white mb-2"></i>
                                                <h6 class="text-white mb-1">OM</h6>
                                                <div class="text-white small">Offsite Marketing</div>
                                            </div>
                                            <div class="card-body text-center" style="background: #f8f9fa;">
                                                <div class="mt-2">
                                                    <div class="text-muted small">Sessions WoW: <span class="fw-bold">+50.0%</span></div>
                                                    <div class="text-muted small">Revenue WoW: <span class="fw-bold">+9.0%</span></div>
                                                    <div class="text-muted small">Traffic: <span class="fw-bold">Growing</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card channel-card" style="border: none;">
                                            <div class="card-header text-center" style="background: linear-gradient(135deg, #ece4db 0%, #ffe5d9 100%); border: none;">
                                                <i class="bi bi-envelope fs-1 text-white mb-2"></i>
                                                <h6 class="text-white mb-1">CRM</h6>
                                                <div class="text-white small">Customer Relationship</div>
                                            </div>
                                            <div class="card-body text-center" style="background: #f8f9fa;">
                                                <div class="mt-2">
                                                    <div class="text-muted small">Sessions WoW: <span class="fw-bold">+23.0%</span></div>
                                                    <div class="text-muted small">Revenue WoW: <span class="fw-bold">+15.0%</span></div>
                                                    <div class="text-muted small">Bookings WoW: <span class="fw-bold">+33.0%</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Detailed Channel Performance -->
                                <div class="row mb-4">
                                    <!-- SEA Channel Details -->
                                    <div class="col-lg-6 mb-3">
                                        <div class="card border-0 h-100">
                                            <div class="card-header border-0" style="background: linear-gradient(135deg, #fec5bb 0%, #fcd5ce 100%);">
                                                <h6 class="mb-0 text-white">
                                                    <i class="bi bi-search me-2"></i>SEA Performance
                                                </h6>
                                            </div>
                                            <div class="card-body" style="background: #f8f9fa;">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Sessions WoW</div>
                                                            <div class="h5 mb-0 text-dark">-7.0%</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Bookings WoW</div>
                                                            <div class="h5 mb-0 text-dark">-18.0%</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <div class="small text-muted">CVR vs LW</div>
                                                            <div class="h5 mb-0 text-success">+11.0%</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Revenue WoW</div>
                                                            <div class="h5 mb-0 text-dark">-12.0%</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="mt-3 pt-3 border-top border-secondary">
                                                    <div class="small text-muted">
                                                        <i class="bi bi-info-circle me-1"></i>
                                                        CVR improved despite volume decline
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- SEO Channel Details -->
                                    <div class="col-lg-6 mb-3">
                                        <div class="card border-0 h-100">
                                            <div class="card-header border-0" style="background: linear-gradient(135deg, #fae1dd 0%, #f8edeb 100%);">
                                                <h6 class="mb-0 text-white">
                                                    <i class="bi bi-globe me-2"></i>SEO Performance
                                                </h6>
                                            </div>
                                            <div class="card-body" style="background: #f8f9fa;">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Sessions WoW</div>
                                                            <div class="h5 mb-0 text-success">+123%</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Brand CTR YoY</div>
                                                            <div class="h5 mb-0 text-success">+11.0%</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Non-Brand CTR YoY</div>
                                                            <div class="h5 mb-0 text-success">+75.0%</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Avg Position</div>
                                                            <div class="h5 mb-0 text-dark">2.3</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="mt-3 pt-3 border-top border-secondary">
                                                    <div class="small text-muted">
                                                        <i class="bi bi-star me-1"></i>
                                                        Top keywords: "pedalo", "piscine avec toboggan"
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Secondary Channels -->
                                <div class="row mb-4">
                                    <!-- OM Channel Details -->
                                    <div class="col-lg-6 mb-3">
                                        <div class="card border-0 h-100">
                                            <div class="card-header border-0" style="background: linear-gradient(135deg, #e8e8e4 0%, #d8e2dc 100%);">
                                                <h6 class="mb-0 text-white">
                                                    <i class="bi bi-bullseye me-2"></i>OM Performance
                                                </h6>
                                            </div>
                                            <div class="card-body" style="background: #f8f9fa;">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Sessions WoW</div>
                                                            <div class="h5 mb-0 text-success">+50.0%</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Revenue WoW</div>
                                                            <div class="h5 mb-0 text-success">+9.0%</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Bookings WoW</div>
                                                            <div class="h5 mb-0 text-success">+15.0%</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="small text-muted">CVR vs LW</div>
                                                            <div class="h5 mb-0 text-dark">-2.0%</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="mt-3 pt-3 border-top border-secondary">
                                                    <div class="small text-muted">
                                                        <i class="bi bi-graph-up me-1"></i>
                                                        Strong traffic growth with improving efficiency
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- CRM Channel Details -->
                                    <div class="col-lg-6 mb-3">
                                        <div class="card border-0 h-100">
                                            <div class="card-header border-0" style="background: linear-gradient(135deg, #ece4db 0%, #ffe5d9 100%);">
                                                <h6 class="mb-0 text-white">
                                                    <i class="bi bi-envelope me-2"></i>CRM Performance
                                                </h6>
                                            </div>
                                            <div class="card-body" style="background: #f8f9fa;">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Sessions WoW</div>
                                                            <div class="h5 mb-0 text-success">+23.0%</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Revenue WoW</div>
                                                            <div class="h5 mb-0 text-success">+15.0%</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <div class="small text-muted">Bookings WoW</div>
                                                            <div class="h5 mb-0 text-success">+33.0%</div>
                                                        </div>
                                                        <div class="mb-2">
                                                            <div class="small text-muted">CVR vs LW</div>
                                                            <div class="h5 mb-0 text-success">+8.0%</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="mt-3 pt-3 border-top border-secondary">
                                                    <div class="small text-muted">
                                                        <i class="bi bi-award me-1"></i>
                                                        Excellent campaign performance across all metrics
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Campaign Insights -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card bg-light border-0 h-100">
                                            <div class="card-header" style="background: #fec5bb; border: none;">
                                                <h6 class="mb-0 text-white">
                                                    <i class="bi bi-graph-up me-2"></i>Performance Highlights
                                                </h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="list-group list-group-flush">
                                                    <div class="list-group-item bg-transparent border-0 px-0">
                                                        <div class="d-flex align-items-center">
                                                            <div class="flex-shrink-0 me-3">
                                                                <span class="badge" style="background: #fae1dd; color: #4a5568;">SEA</span>
                                                            </div>
                                                            <div class="flex-grow-1">
                                                                <div class="fw-semibold">CVR improved +11% vs LW</div>
                                                                <div class="text-muted small">Despite volume decline</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="list-group-item bg-transparent border-0 px-0">
                                                        <div class="d-flex align-items-center">
                                                            <div class="flex-shrink-0 me-3">
                                                                <span class="badge" style="background: #e8e8e4; color: #4a5568;">SEO</span>
                                                            </div>
                                                            <div class="flex-grow-1">
                                                                <div class="fw-semibold">Non-brand traffic surge +123%</div>
                                                                <div class="text-muted small">Strong YoY growth</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="list-group-item bg-transparent border-0 px-0">
                                                        <div class="d-flex align-items-center">
                                                            <div class="flex-shrink-0 me-3">
                                                                <span class="badge" style="background: #ffe5d9; color: #4a5568;">CRM</span>
                                                            </div>
                                                            <div class="flex-grow-1">
                                                                <div class="fw-semibold">Bookings growth +33% WoW</div>
                                                                <div class="text-muted small">Excellent campaign performance</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-light border-0 h-100">
                                            <div class="card-header" style="background: #ffd7ba; border: none;">
                                                <h6 class="mb-0 text-white">
                                                    <i class="bi bi-exclamation-triangle me-2"></i>Key Insights
                                                </h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <div class="fw-semibold text-muted mb-2">Campaign Performance</div>
                                                    <div class="small">Summer Sales generated <strong>174 bookings</strong> across all channels</div>
                                                </div>
                                                <div class="mb-3">
                                                    <div class="fw-semibold text-muted mb-2">SEO Growth</div>
                                                    <div class="small">Top performing keywords: <strong>"pedalo"</strong>, <strong>"piscine avec toboggan"</strong></div>
                                                </div>
                                                <div class="mb-3">
                                                    <div class="fw-semibold text-muted mb-2">OM Channel</div>
                                                    <div class="small">Strong traffic growth (+50% WoW) with improving efficiency</div>
                                                </div>
                                                <div class="mb-3">
                                                    <div class="fw-semibold text-muted mb-2">CRM Excellence</div>
                                                    <div class="small">Best performing channel with consistent growth across all metrics</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
    loadWeeks();
});

async function loadWeeks() {
    try {
        const selector = document.getElementById('weekSelector');
        selector.innerHTML = '<option value="">Sélectionnez une semaine</option>';
        
        // Hardcoded week data pour les données du 15 juillet
        const weeks = [
            {
                id: 1,
                week_number: 29,
                start_date: '2024-07-15',
                end_date: '2024-07-21'
            }
        ];
        
        weeks.forEach(week => {
            const option = document.createElement('option');
            option.value = week.id;
            option.textContent = `Semaine ${week.week_number} (${week.start_date} - ${week.end_date})`;
            selector.appendChild(option);
        });
        
        // Auto-select the latest week
        if (weeks.length > 0) {
            selector.value = weeks[0].id;
        }
    } catch (error) {
        console.error('Error loading weeks:', error);
    }
}

// Week selector change event
document.getElementById('weekSelector').addEventListener('change', function() {
    if (this.value) {
        window.location.href = `/analytics/acquisition?week=${this.value}`;
    }
});
</script>

{% endblock %}